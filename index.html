<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>D3 Examples</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <script src="js/lib/d3.v3.min.js"></script>
</head>
<body class="container">
<h1>D3 Examples</h1><hr />

<<div class="col-md-4">
    <select id="select" class="form-control" onchange="select()">
        <option>All</option>
        <option>Apple</option>
        <option>Samsung</option>
    </select>
</div>
<div class="col-md-4">
    <select id="selectSort" class="form-control" onchange="sort()">
        <option selected disabled>Режим сортировки</option>
        <option value="compareByCompany">По компании</option>
        <option value="compareByPrice">По цене</option>
        <option value="compareByName">По названию</option>
    </select>
</div>
<br /><br /><br />

<div class="col-md-12">
    <div class="diagram"></div>
</div>

<script type="text/javascript">
    /*var phones = [ {name: 'iPhone 6', price: 64},
        {name: 'Samsung Galaxy S5', price: 48},
        {name: 'LG G4', price: 36},
        {name : 'MiPad 5', price: 25}];

    // Enter
    d3.select('div.diagram').selectAll('div').data(phones).enter().append('div').attr('class', 'item')
            .append('div').attr('class', 'data').append('span');

    // Update
    d3.select('div.diagram').selectAll('div.item').data(phones)
            .select('div').style('width', function (d) { return (d.price * 3) + 'px';})
            .select('span').text(function (d) { return d.price;});

    d3.select('div.diagram').selectAll('div.item').data(phones).append('div').attr('class', 'name')
            .text(function (d) {return d.name;});

    // Exit
    d3.select('div.diagram').selectAll('div.item').data(phones).exit().remove();*/


    /*var phones = [ {name: 'iPhone 6', price: 64, company: 'Apple'},
        {name: 'Samsung Galaxy Tab 4', price: 28, company:'Samsung'},
        {name: 'iPhone 5s', price: 49, company: 'Apple'},
        {name: 'Samsung Galaxy S5', price: 48, company:'Samsung'},
        {name: 'iPad Air', price: 37, company: 'Apple'},
        {name: 'Samsung Galaxy Note', price: 36, company:'Samsung'}];

    function showGraph(phones, company){

        d3.select('div.diagram').selectAll('div.item').data(phones).enter().append('div')
                .attr('class', 'item').append('span');

        d3.select('div.diagram').selectAll('div.item').data(phones)
                .attr("class", "item").style('width', function (d) { return (d.price * 6) + 'px';})
                .select('span').text(function (d) { return d.name;});

        d3.select('div.diagram').selectAll('div.item').data(phones).exit().remove();

        d3.select("div.diagram").selectAll("div.item")
                .filter(function (d, i) {
                    if(company && company!=='All')
                        return !(d.company == company);
                    else
                        return false;
                })
                .classed("unselected", true);
    }

    function select() {
        var company = document.getElementById("select").value;
        showGraph(phones, company);
    }

    showGraph(phones);*/


    var phones = [ {name: 'iPhone 6', price: 64, company: 'Apple'},
        {name: 'Samsung Galaxy Tab 4', price: 28, company:'Samsung'},
        {name: 'iPhone 5s', price: 49, company: 'Apple'},
        {name: 'Samsung Galaxy S5', price: 48, company:'Samsung'},
        {name: 'iPad Air', price: 37, company: 'Apple'},
        {name: 'Samsung Galaxy Note', price: 36, company:'Samsung'}];

    function showGraph(phones, comparator){

        d3.select('div.diagram').selectAll('div.item').data(phones).enter().append('div')
                .attr('class', 'item').append('span');

        d3.select('div.diagram').selectAll('div.item').data(phones)
                .attr("class", "item").style('width', function (d) { return (d.price * 6) + 'px';})
                .select('span').text(function (d) { return d.name;});

        d3.select('div.diagram').selectAll('div.item').data(phones).exit().remove();
        if(comparator){
            d3.select("div.diagram").selectAll("div.item").sort(comparator);
        }
    }

    var compareByName = function (a, b) { // <-F
        return a.name < b.name?-1:1;
    };
    var compareByPrice = function (a, b) { // <-G
        return a.price < b.price?-1:1;
    };
    var compareByCompany = function (a, b) { // <-G
        return a.company < b.company?-1:1;
    };

    function sort() {
        var comparator = document.getElementById("selectSort").value;
        switch(comparator){

            case "compareByCompany" :
                comparator= compareByCompany;
                break;
            case "compareByName" :
                comparator= compareByName;
                break;
            case "compareByPrice" :
                comparator= compareByPrice;
                break;
        }

        showGraph(phones, comparator);
    }

    showGraph(phones);
</script>


<script type="text/javascript">
    var data = [3, 8, 21, 13, 1, 2, 5];
    console.log('d3.max: ' + d3.max(data));
    console.log('d3.min: ' + d3.min(data));
    console.log('d3.extent: ' + d3.extent(data));
    console.log('d3.sum: ' + d3.sum(data));
    console.log('d3.median: ' + d3.median(data));
    console.log('d3.mean: ' + d3.mean(data));
    console.log('d3.quantile: ' + d3.quantile(data.sort(d3.ascending), 0.25));
    console.log('d3.ascending: ' + data.sort(d3.ascending));
    console.log('d3.descending: ' + data.sort(d3.descending));
    console.log('d3.bisect: '+ d3.bisect(data.sort(d3.ascending), 11));
    console.log('');


    // группировка данных
    var phones = [ {name: 'iPhone 6', price: 64, company: 'Apple'},
        {name: 'Samsung Galaxy S5', price: 48, company:'Samsung'},
        {name: 'iPhone 5s', price: 49, company: 'Apple'},
        {name: 'Samsung Galaxy Note', price: 36, company:'Samsung'},
        {name: 'iPad Air', price: 37, company: 'Apple'},
        {name: 'Samsung Galaxy Tab 4', price: 28, company:'Samsung'}];

    var nest = d3.nest().key(function (d) {
        return d.company;
    }).entries(phones);

    //специальная функция для вывода объектов
    function printArray(nest) {

        nest.forEach(function (e) {
            if (e.key)
                console.log(e.key);
            else
                console.log(printObject(e));
            if (e.values)
                printArray(e.values);
        });
    }
    function printObject(obj) {
        var s = "{";
        for (var f in obj) {
            s += f + ": " + obj[f] + ", ";
        }
        s += "}";
        return s;
    }

    printArray(nest);

</script>

</body>
</html>